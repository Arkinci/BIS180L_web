---
title: "Make a web app with Shiny"
layout: lab
tags:
- R
hidden: true
output: html_document
---

Today we will learn how to make and deploy interactive web applications with [Shiny](http://shiny.rstudio.com/).  Shiny allows you to display your R analysis on the web to anyone.  For example, here is an application that I wrote to visualize a [Markov Chain simulation of genetic drift](http://symposium.plb.ucdavis.edu:3838/MarkovDrift/).  A student from last years BIS180L is now working in my lab and is working up a [visualizer for QTL data and gene expression](http://symposium.plb.ucdavis.edu:3838/QTL-Visualization/).  The Shiny website has plenty of [additional examples](http://shiny.rstudio.com/gallery/).

The [tutorial at Rstudio](http://shiny.rstudio.com/tutorial/) is good but pretty involved.  I have tried to distill some of the prinicples below; if you like it and want more then feel free to do the [tutorial](http://shiny.rstudio.com/tutorial/) as well.

## Teams

Today we will work in teams of three.  Each team will produce and deploy a Shiny app that will be collectively graded.

| Student 1              | Student 2              | Student 3      | Repository                 |
|------------------------|------------------------|----------------|----------------------------|
| Tyler Kent             | Gurkern Sufi           | Chadwick Ho    | Shiny_Tyler.Sufi.Chad      |
| Samuel Deck            | Ed Sung                | Nabeel Sami    | Shiny_Sam.Ed.Nabeel        |
| Derek Conkle-Gutierrez | Maria I Chacon Sanchez | Kevin Hu       | Shiny_Derek.Maria.Kevin    |
| Anna Alekina           | Kristina Bow           | Robert Rider   | Shiny_Anna.Kristina.Bobby  |
| Lewis Roa              | Jenny Cade             | Daniel Ahrens  | Shiny_Lewis.Jenny.Daniel   |
| Matthew Denny          | Derek Lin              | Marina Becker  | Shiny_Matthew.Derek.Marina |
| Eric Wetzel            | Evan Adams             | Calvin Mackey  | Shiny_Eric.Evan.Calvin     |
| Scot Nicol             | Patrick Mahle          | Anjali Kadakia | Shiny_Scot.Patrick.Anjali  |
| Heesun Cha             | Khoa Nguyen            | Andy Peng      | Shiny_Sunny.Khoa.Andy      |
| Leslie Herrera         | Pallavi Setty          |                | Shiny_Leslie.Pallavi       |


## Preliminaries

Make sure that you have the latest version of Shiny and Shinyapps

```{r prelim, eval=FALSE}
install.packages(shiny) #Needed for making ShinyApps
devtools::install_github('rstudio/shinyapps') #this is only needed for deployment on the shinyapp web server.
```


## Components of a Shiny App

A ShinyApp consists of two R scripts:

* __ui.R__ This script controls the user interface (i.e. the design of the webpage, the input and the output).
* __server.R__ This script does the work of performing any analysis, creating graphs, and creating tables

These two scripts must be saved together in a single directory.  Each app much be saved in a different directory.

## ui.R

Here is a sample ui.R script.  This script makes use of R's build in data set on iris.  For more information on this data set you can type `?iris` in R.

``` {r, eval=FALSE}
library(shiny)

# Define UI for application that draws a histogram
shinyUI(fluidPage( #create the overall page
  
  # Application title
  titlePanel("Iris Data"),
  
  # Some helpful information
  helpText("This application creates a boxplot to show difference between",
           "iris species.  Please use the radio box below to choose a trait",
           "for plotting"),
  
  # Sidebar with a radio box to input which trait will be plotted
  sidebarLayout(
    sidebarPanel(
      radioButtons("trait", #the input variable that the value will go into
                   "Choose a trait to display:",
                   c("Sepal.Length",
                     "Sepal.Width",
                     "Petal.Length",
                     "Petal.Width")
      )),
      
      # Show a plot of the generated distribution
      mainPanel(
        plotOutput("boxPlot")
      )
    )
  ))


```

There are several components in the above script (and note that they are nested)

* _shinyUI_ This is the overall function that creates that user interface
  * _fluidPage_ This creates the layout for our webpage.  The webpage has three components:
  * _titlePanel_ Should be obvious
  * _sidebarLayout_ Creates a sidebar layout within fluidpage
    * _sidebarPanel_ specifies the sidebar panel.  
      * _radioButtons_ specifies that we want radio buttons in this sidebar panel.  We could have additional input functions here.
    * _mainPanel_ specifices that we want a main panel as well
    * _plotOutput_ what we want on the main panel.  We could have more than one of these, or could have tables, etc.

To see all the types of input and output that can be included, see the [Shiny reference](http://shiny.rstudio.com/reference/shiny/latest/).  Of particular interest:
* _tabPanel_ if we want multiple tabs on the page
* _checkboxInput_
* _sliderInput_
* _tableOutput_
* _textOutput_

## server.R
Below is an example of a server script to acompany the ui script above

```{r server, eval=FALSE}
library(shiny)
library(ggplot2)

# Define server logic required to draw a boxplot
shinyServer(function(input, output) {
  
  # Expression that generates a boxplot. The expression is
  # wrapped in a call to renderPlot to indicate that:
  #
  #  1) It is "reactive" and therefore should re-execute automatically
  #     when inputs change
  #  2) Its output type is a plot
    
  output$boxPlot <- renderPlot({
    
    # set up the plot
    pl <- ggplot(data = iris,
                 #Use aes_string below so that input$trait is interpreted
                 #correctly.  The other variables need to be quoted
                 aes_string(x="Species",
                            y=input$trait,
                            fill="Species"
                            )
    )
    
    # draw the boxplot for the specified trait
    pl + geom_boxplot()
  })
})
```

The key elements of the above script:

* _shinyServer_ this creates the server application.
  * _renderPlot_ this tells R that the enlcosed code will generate a plot that is to be put on the webpage.  Note that there are similar functions for outputting tables and text.
* information is passed between the ui.R and server.R scripts via the `input` and `output` variables.
  * In the ui.R script we specified that the `radioButton()` information should be placed in "trait". server.R accesses that through `input$trait`
  * Similarly in the server.R script we specify that the rendered plot goes into output$boxPlot.  This in ui.R we can access the plot as "boxPlot"
* Pay attention to the modifications in how variable are given in the `aes_string()` arguement to `ggplot`.  This is different then what you have seen before with `aes` but enables direct access to `input$trait` from ggplot possible.
* __Important__ any one-time data loading or manipulation (i.e. reading in a file) should be done BEFORE, not within, any `renderNNN` statements.  You can put it just below the `library` statements, before the `shinyServer`

## trying it

To try the app on your computer, save the above scripts in ui.R and server.R, respectively, in a directory for this app.

## deployment

Now that we have our awesome application how do we share it?

Multiple options:

1. If you are sharing it with someone that uses R and has the shiny library installed, then you can just send it to 

## Practice 1

Change the scripts above so that a violin plot is used.

## Practice 2

Change the scripts above so that all of the traits are plotted but only for a single species

## Assignment

Your team should create and deploy a Shiny App that plots some aspect of the data from the BLAST or RICE labs.  The app should allow user input that modifies the plot in a useful way.

Some ideas:

### BLAST
* Scatter plot of 

### Scoring (out of 20 points)

14 points for (reasonable) code, even if it doesn't run.  
+ 2 points for functional web app deployed on shinyapps.io .  
+ 2 points for using two or more input types.  
+ 2 points for good annotation on the web page (a new user would understand what the app is about).  
- 2 points (on a student-by-student basis) for each student that did not make at least 2 commits to the team repository.





## Going further

You can also include Shiny apps [directly in your Rmarkdown files](http://rmarkdown.rstudio.com/authoring_shiny.html) to be rendered into html.  In some ways the syntax is even easier because you only need a single file.  You can also include interactive graphs in slide presentations this way.